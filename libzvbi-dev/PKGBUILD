pkgname=libzvbi-dev
pkgver=0.2.37
pkgrel=1
pkgdesc='A VBI decoding library which can be used by FFmpeg to decode DVB teletext pages and DVB teletext subtitles'
arch=('x86_64')
url="https://github.com/zapping-vbi/zvbi"
makedepends=('libiconv-dev' 'libpng-dev')
license=('BSD' 'GPL2' 'LGPL2.1' 'MIT')
source=("git+https://github.com/zapping-vbi/zvbi.git"
        "https://raw.githubusercontent.com/videolan/vlc/master/contrib/src/zvbi/zvbi-fix-clang-support.patch"
        "https://raw.githubusercontent.com/videolan/vlc/master/contrib/src/zvbi/zvbi-fix-static-linking.patch"
        "https://raw.githubusercontent.com/videolan/vlc/master/contrib/src/zvbi/zvbi-ioctl.patch"
        "https://raw.githubusercontent.com/videolan/vlc/master/contrib/src/zvbi/zvbi-ssize_max.patch"
        "https://raw.githubusercontent.com/videolan/vlc/master/contrib/src/zvbi/zvbi-win32.patch")
md5sums=('SKIP' 'SKIP' 'SKIP' 'SKIP' 'SKIP' 'SKIP')

build() {
  cd $srcdir/zvbi
  sed -i 's/configure.in/configure.ac/g' $srcdir/zvbi-fix-static-linking.patch
  for patch in $srcdir/*.patch; do
      echo "Applying $patch"
      patch -p1 < "$patch"
  done
  autoreconf -ivf
  #export LIBS="-lpng -liconv -lpthread"
  ./configure --prefix=/opt \
    --disable-shared \
    --enable-static \
    --with-pic \
    --without-doxygen \
    --without-x \
    --disable-dvb \
    --disable-bktr \
    --disable-nls \
    --disable-proxy
  make -C src
}

package() {
  cd $srcdir/zvbi
  DESTDIR=$pkgdir make -C src install
  DESTDIR=$pkgdir make SUBDIRS=. install  
}
