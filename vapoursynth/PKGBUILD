# Maintainer: nyfair <nyfair2012@gmail.com>
pkgname=(vapoursynth-dev vapoursynth-plugin-core-extra vapoursynth)
pkgver=57
pkgrel=1
pkgdesc='A video processing framework with the future in mind'
arch=('x86_64')
url="http://www.vapoursynth.com/"
license=('LGPL')
source=("https://github.com/vapoursynth/vapoursynth/releases/download/R$pkgver/VapourSynth64-Portable-R$pkgver.7z")
options=(!strip)
md5sums=('SKIP')

build() {
  cd $srcdir/VapourSynth64-Portable-R$pkgver
  rm *7z* con* ms* vc* MANIFEST* setup.py vs-detect-python.bat VSScriptPython38.dll
  rm -rf doc
  rm vapoursynth64/plugins/.keep
}

package_vapoursynth-dev() {
  cd $srcdir/VapourSynth64-Portable-R$pkgver
  mkdir -p $pkgdir/opt
  mv sdk/include $pkgdir/opt
  mv sdk/lib64 $pkgdir/opt/lib
  mkdir -p $pkgdir/opt/lib/pkgconfig
  cp ../*.pc $pkgdir/opt/lib/pkgconfig
  sed -i "s/_ver/$pkgver/" $pkgdir/opt/lib/pkgconfig/vapoursynth.pc
  sed -i "s/_ver/$pkgver/" $pkgdir/opt/lib/pkgconfig/vapoursynth-script.pc
}

package_vapoursynth-plugin-core-extra() {
  depends=('vapoursynth')
  export PKGEXT='.pkg.tar.xz'
  cd $srcdir/VapourSynth64-Portable-R$pkgver
  mkdir -p $pkgdir/opt/bin/vapoursynth64/coreplugins
  mv *.exe $pkgdir/opt/bin
  mv vsrepo.py $pkgdir/opt/bin
  mv VSVFW.dll $pkgdir/opt/bin
  mv vapoursynth64/coreplugins/AvsCompat.dll $pkgdir/opt/bin/vapoursynth64/coreplugins
}

package_vapoursynth() {
  optdepends=('python-embed>=3.9')
  rm -rf $srcdir/VapourSynth64-Portable-R$pkgver/sdk
  mkdir $pkgdir/opt
  mv $srcdir/VapourSynth64-Portable-R$pkgver $pkgdir/opt/bin
}
