pkgname=rav1e-dev
pkgver=0.6.6
pkgrel=1
pkgdesc='The fastest and safest AV1 encoder'
arch=('x86_64')
url="https://github.com/xiph/rav1e/"
license=('spdx:BSD-2-Clause')
source=("git+https://github.com/xiph/rav1e.git#tag=v$pkgver")
md5sums=('SKIP')

package() {  
  cd $srcdir/rav1e
  #llvm-ar rcs /d/ucrt64/lib/libgcc_eh.a
  #llvm-ar rcs /d/ucrt64/lib/libgcc.a
  #cp /d/ucrt64/x86_64-w64-mingw32/lib/libc++.a /d/ucrt64/x86_64-w64-mingw32/lib/libstdc++.a
#  cat >> /d/.cargo/config.toml <<END
#[profile.release]
#panic = "abort"
#
#[profile.dev]
#panic="abort"
#END

  #LDFLAGS="-fuse-ld=lld -rtlib=compiler-rt -unwindlib=libunwind"
  export CARGO_PROFILE_RELEASE_CODEGEN_UNITS=1
  export CARGO_PROFILE_RELEASE_DEBUG=false
  export CARGO_PROFILE_RELEASE_INCREMENTAL=false
  export CARGO_PROFILE_RELEASE_LTO=off
  cargo cinstall --manifest-path=Cargo.toml --prefix=/opt --destdir=$pkgdir --release --target x86_64-pc-windows-gnu --crt-static --library-type staticlib
  mv $pkgdir/msys64/* $pkgdir
  rm -rf $pkgdir/msys64
}
